<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Batman Tag Hunt - Dual Mode</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background-color: #121212;
      color: #f1c40f;
      text-align: center;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    h1 {
      font-size: 3em;
      margin-bottom: 5px;
      line-height: 1.1;
    }

    p.description {
      font-size: 1.2em;
      max-width: 90vw;
      margin: 0 auto 20px;
    }

    .mode-toggle {
      margin-bottom: 30px;
    }

    button#toggleMode {
      background: #f1c40f;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      color: black;
      font-size: 1em;
      box-shadow: 0 0 10px #f1c40f;
      transition: background 0.3s ease;
    }

    button#toggleMode:hover {
      background: #d4ac0d;
    }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      max-width: 95vw;
      margin-bottom: 30px;
    }

    .tag {
      flex: 1 1 40vw;
      max-width: 180px;
      min-width: 140px;
      padding: 25px;
      font-size: 1.2em;
      border-radius: 14px;
      box-shadow: 0 0 12px rgba(241, 196, 15, 0.6);
      transition: all 0.3s ease;
      background: #2c3e50;
      color: #f1c40f;
      white-space: pre-line;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .found {
      background: #27ae60;
      color: #ffffff;
      box-shadow: 0 0 18px rgba(39, 174, 96, 0.8);
    }

    #message {
      font-size: 1.4em;
      margin-bottom: 25px;
      max-width: 90vw;
      min-height: 2.5em;
    }

    #prize {
      font-size: 2em;
      padding: 25px;
      border-radius: 16px;
      max-width: 90vw;
      margin-bottom: 25px;
      display: none;
      background: #000;
      color: #f1c40f;
      border: 2px solid #f1c40f;
      box-shadow: 0 0 15px rgba(241, 196, 15, 0.8);
    }

    #resetBtn {
      font-size: 1.4em;
      padding: 15px 30px;
      border-radius: 12px;
      max-width: 90vw;
      cursor: pointer;
      background: #c0392b;
      color: white;
      border: none;
      transition: background 0.3s;
    }

    #resetBtn:hover {
      background: #e74c3c;
    }

    @media (min-width: 768px) {
      body {
        padding: 40px 60px;
      }
      .tag {
        flex: 1 1 130px;
        max-width: 130px;
        min-width: 120px;
        padding: 15px;
        font-size: 1em;
        min-height: 120px;
      }
    }
  </style>
</head>
<body>
  <h1>Batman Tag Hunt</h1>
  <p class="description" id="descriptionText">Find all 7 hidden bat-tags to defeat Gotham's villains.</p>

  <div class="mode-toggle">
    <button id="toggleMode" aria-pressed="false">Switch to Riddler Mode</button>
  </div>

  <div class="tag-list" id="tagList"></div>

  <div id="message"></div>
  <div id="prize">
    <strong>Mission Complete</strong><br />
    You've completed the challenge!<br />
    üéÅ Collect your reward.
  </div>

  <button id="resetBtn">Reset Game</button>

  <script>
    const VILLAIN_TAGS = {
      tag1: "Joker",
      tag2: "Riddler",
      tag3: "Bane",
      tag4: "Catwoman",
      tag5: "Penguin",
      tag6: "Two-Face",
      tag7: "Scarecrow",
    };

    const RIDDLER_TAGS = {
      tag1: "I speak without a mouth and hear without ears. I have nobody, but I come alive with wind. What am I?",
      tag2: "I‚Äôm tall when I‚Äôm young, and I‚Äôm short when I‚Äôm old. What am I?",
      tag3: "The more you take, the more you leave behind. What am I?",
      tag4: "What has hands but can‚Äôt clap?",
      tag5: "I have cities but no houses, forests but no trees, and rivers but no water. What am I?",
      tag6: "What can fill a room but takes up no space?",
      tag7: "I‚Äôm light as a feather, yet the strongest man can‚Äôt hold me for much longer than a minute. What am I?"
    };

    // Keys for localStorage based on mode
    const STORAGE_KEYS = {
      villains: "foundVillains",
      riddles: "foundRiddles",
      mode: "batmanTagMode",
    };

    // Elements
    const tagList = document.getElementById("tagList");
    const message = document.getElementById("message");
    const prize = document.getElementById("prize");
    const resetBtn = document.getElementById("resetBtn");
    const toggleModeBtn = document.getElementById("toggleMode");
    const descriptionText = document.getElementById("descriptionText");

    // Current mode: 'villains' or 'riddles'
    let mode = localStorage.getItem(STORAGE_KEYS.mode) || "villains";

    // Load progress based on mode
    function loadProgress() {
      try {
        const saved = localStorage.getItem(mode === "villains" ? STORAGE_KEYS.villains : STORAGE_KEYS.riddles);
        return saved ? JSON.parse(saved) : [];
      } catch {
        return [];
      }
    }

    // Save progress based on mode
    function saveProgress(found) {
      localStorage.setItem(mode === "villains" ? STORAGE_KEYS.villains : STORAGE_KEYS.riddles, JSON.stringify(found));
    }

    // Get tags data based on mode
    function getTagsData() {
      return mode === "villains" ? VILLAIN_TAGS : RIDDLER_TAGS;
    }

    // Render the tags list
    function renderTags(foundTags) {
      const tagsData = getTagsData();
      tagList.innerHTML = "";
      Object.entries(tagsData).forEach(([tagId, text]) => {
        const div = document.createElement("div");
        const isFound = foundTags.includes(tagId);
        div.className = "tag" + (isFound ? " found" : "");
        div.textContent = isFound ? (mode === "villains" ? `‚úÖ ${text}` : text) : (mode === "villains" ? text : "‚ùì Riddle hidden");
        tagList.appendChild(div);
      });
    }

    // Update messages and prize display
    function updateMessages(foundTags) {
      const total = Object.keys(getTagsData()).length;
      if (foundTags.length === total) {
        message.textContent = mode === "villains"
          ? "You've defeated all the villains!"
          : "You've solved all the riddles!";
        prize.style.display = "block";
      } else {
        message.textContent = mode === "villains"
          ? `Progress: ${foundTags.length} of ${total} villains captured.`
          : `Progress: ${foundTags.length} of ${total} riddles solved.`;
        prize.style.display = "none";
      }
    }

    // Handle a scanned tag
    function handleScannedTag(tagId, foundTags) {
      if (!foundTags.includes(tagId) && Object.keys(getTagsData()).includes(tagId)) {
        foundTags.push(tagId);
        saveProgress(foundTags);
      }
    }

    // Initialize the game state & UI
    function init() {
      // Set description and toggle button text based on mode
      if (mode === "villains") {
        descriptionText.textContent = "Find all 7 hidden bat-tags to defeat Gotham's villains.";
        toggleModeBtn.textContent = "Switch to Riddler Mode";
        toggleModeBtn.setAttribute("aria-pressed", "false");
      } else {
        descriptionText.textContent = "Solve all 7 riddles left by the Riddler.";
        toggleModeBtn.textContent = "Switch to Villains Mode";
        toggleModeBtn.setAttribute("aria-pressed", "true");
      }

      // Parse current scanned tag from URL
      const params = new URLSearchParams(window.location.search);
      const currentTag = params.get("tag");

      let foundTags = loadProgress();

      if (currentTag) {
        handleScannedTag(currentTag, foundTags);
      }

      renderTags(foundTags);
      updateMessages(foundTags);
    }

    // Toggle between modes and reset UI
    toggleModeBtn.addEventListener("click", () => {
      mode = mode === "villains" ? "riddles" : "villains";
      localStorage.setItem(STORAGE_KEYS.mode, mode);
      // Clear URL tag param to avoid auto-adding in new mode
      if (window.history.replaceState) {
        const url = new URL(window.location);
        url.searchParams.delete("tag");
        window.history.replaceState({}, document.title, url.toString());
      }
      init();
    });

    // Reset game progress for both modes
    resetBtn.addEventListener("click", () => {
      localStorage.removeItem(STORAGE_KEYS.villains);
      localStorage.removeItem(STORAGE_KEYS.riddles);
      window.location.href = window.location.pathname; // Reload without query params
    });

    // Initial load
    init();
  </script>
</body>
</html>
